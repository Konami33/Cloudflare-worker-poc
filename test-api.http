### Cloudflare Worker - Lab Sessions API Tests
### REST Client file for testing API endpoints
### Use VS Code REST Client extension or similar tools

### Variables
# @baseUrl = http://localhost:8787
@baseUrl = https://cloudflare-worker-labs-service.konami9889.workers.dev
@userId = 675993586c0850de6534d90d
@contentType = application/json
@authToken = 4ad4f848ee5f211a1d8e67502f4bcc7ce7707d556049c18c5ba4c8cef59b0676

###############################################
# Health Check & Info
###############################################

### Health Check
GET {{baseUrl}}/health

### API Documentation (Root)
GET {{baseUrl}}/

###############################################
# Create Lab Session (POST)
###############################################

### Create New Lab Session - Full Example (Requires Authentication)
POST {{baseUrl}}/api/v1/labs/sessions
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "labId": "67581a67fd07f8bfcaaca048",
  "labTitle": "Setting Up a Host-Like Environment Using Docker Containers",
  "labGroupID": "67542ed7108d71b2684c7528",
  "moduleID": "6757d980fd07f8bfcaac8d54",
  "duration": 10,
  "activatedAt": "2025-11-12T13:03:47.769Z",
  "counterID": "67581a67fd07f8bfcaaca048",
  "configId": "382339e0-db1d-4e7e-aabc-36d658fc8ac9",
  "workerConfigId": "Thead339e0-db1d-4e7e-aabc-36d658fc8ac9",
  "lab_request_id": "5af57aba-e556-4dba-a161-381ac2b5a369",
  "user_id": "675993586c0850de6534d90d",
  "terminal_url": "https://675993586c0850de6534d90d_f853b25b.terminal-stag.poridhi.io",
  "vm": {
    "name": "vm-vm-1-5af57aba-dc18e5",
    "network_id": "04843d58-d0b5-4b31-8e1c-647219d916b3",
    "netbird_ip": "100.125.73.55"
  },
  "validation": 1762957127782
}

###############################################
# Get Lab Session (GET)
###############################################

### Get Lab Session by User ID (Requires Authentication)
GET {{baseUrl}}/api/v1/labs/sessions/user/{{userId}}
Authorization: Bearer {{authToken}}

###############################################
# Update Lab Session (PUT)
###############################################

### Update Lab Session - Add Worker Nodes (Requires Authentication)
PUT {{baseUrl}}/api/v1/labs/sessions/{{userId}}
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "worker_nodes": [
    {
      "name": "k3s-worker-1",
      "worker_lab_request_id": "worker-req-1",
      "network_id": "4eeee504-a9cc-46eb-9121-32fb9dd51975",
      "netbird_ip": "100.125.42.245"
    },
    {
      "name": "k3s-worker-2",
      "worker_lab_request_id": "worker-req-2",
      "network_id": "4eeee504-a9cc-46eb-9121-32fb9dd51975",
      "netbird_ip": "100.125.42.246"
    }
  ]
}

### Update Lab Session - Add Load Balancers
PUT {{baseUrl}}/api/v1/labs/sessions/{{userId}}
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "loadBalancers": [
    {
      "id": "lb-001",
      "domain": "user-app.lb-stag.poridhi.io",
      "port": "8080"
    },
    {
      "id": "lb-002",
      "domain": "user-api.lb-stag.poridhi.io",
      "port": "3000"
    }
  ]
}

### Update Lab Session - Multiple Fields (Requires Authentication)
PUT {{baseUrl}}/api/v1/labs/sessions/{{userId}}
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "vscode_domain": "updated-vscode.example.com",
  "puku_domain": "updated-puku.example.com",
  "terminal_url": "https://updated-terminal.example.com",
  "worker_nodes": [
    {
      "name": "k3s-worker-3",
      "worker_lab_request_id": "worker-req-3",
      "network_id": "4eeee504-a9cc-46eb-9121-32fb9dd51975",
      "netbird_ip": "100.125.42.247"
    }
  ],
  "loadBalancers": [
    {
      "id": "lb-003",
      "domain": "new-app.lb-stag.poridhi.io",
      "port": "9000"
    }
  ]
}

###############################################
# Delete Lab Session (DELETE)
###############################################

### Delete Lab Session by User ID (Requires Authentication)
DELETE {{baseUrl}}/api/v1/labs/sessions/{{userId}}
Authorization: Bearer {{authToken}}