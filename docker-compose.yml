version: '3.8'

services:
  cloudflare-worker:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: cloudflare-worker-labs
    ports:
      - "8787:8787"
    volumes:
      # Mount source code for live reload
      - ./src:/app/src
      - ./wrangler.toml:/app/wrangler.toml
      - ./schema.sql:/app/schema.sql
      # Mount node_modules as volume for better performance
      - node_modules:/app/node_modules
      # Mount Wrangler config (for authentication)
      - ~/.wrangler:/root/.wrangler:ro
    environment:
      - NODE_ENV=development
      - WRANGLER_SEND_METRICS=false
    command: npx wrangler dev --remote --ip 0.0.0.0
    restart: unless-stopped
    stdin_open: true
    tty: true

volumes:
  node_modules:
